
@{
}

<style type="text/css">
    body {
        color: #566787;
        background: #f5f5f5;
        /* font-family: 'Varela Round', sans-serif; */
        /* font-size: 13px; */
    }

    .status {
        font-size: 30px;
        margin: 2px 2px 0 0;
        display: inline-block;
        vertical-align: middle;
        line-height: 10px;
    }

    .table-title {
        color: #fff;
        background: #4b5366;
        /*     padding: 16px 25px;
                            margin: -20px -25px 10px; */
        border-radius: 3px 3px 0 0;
    }

        .table-title h2 {
            margin: 5px 0 0;
            font-size: 24px;
        }

    .containerDtl {
        height: 100%;
        width: 100%;
        border-radius: 10px;
        overflow: hidden;
        background-color: white;
        padding: 30px;
    }

    .containerDtlHistory {
        width: 100%;
        border-radius: 10px;
        overflow: hidden;
        background-color: white;
        padding: 30px;
    }

        .containerDtlHistory p {
            margin-bottom: 0;
        }

        .containerDtlHistory input {
            /* padding: 10px 0; */
            margin-bottom: 10px;
        }

    .progressBar {
        margin-bottom: 30px;
        overflow: hidden;
        color: lightgray;
    }

        .progressBar li {
            list-style-type: none;
            font-size: 15px;
            width: 20%;
            float: left;
            font-weight: 400;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .progressBar .active {
            color: #673ab7;
        }

        .progressBar li::before {
            width: 50px;
            height: 50px;
            line-height: 50px;
            display: block;
            font-size: 20px;
            color: #fff;
            background: lightgrey;
            border-radius: 50%;
            margin: 0 auto 10px auto;
            padding: 2px;
        }

        .progressBar li::after {
            content: "";
            width: 100%;
            height: 2px;
            background: lightgrey;
            position: absolute;
            left: 50px;
            top: 25px;
            z-index: -1;
        }

        .progressBar li.active::before {
            background: #673ab7;
        }

        .progressBar li.next::after {
            background: #673ab7;
        }

        .progressBar #step1::before {
            content: "1";
            font-family: Arial;
        }

        .progressBar #step2::before {
            content: "2";
            font-family: Arial;
        }

        .progressBar #step3::before {
            content: "3";
            font-family: Arial;
        }

        .progressBar #step4::before {
            content: "4";
            font-family: Arial;
        }

        .progressBar #stepLast::before {
            content: "5";
            font-family: Arial;
        }

        .progressBar #stepLast::after {
            width: 0;
        }

    .form-group {
        display: none;
    }

        .form-group.form-active {
            display: block;
            margin: 30px 0;
        }

    .form-group-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding-bottom: 10px;
    }

    .form-title {
        color: #673ab7;
        text-align: center;
        font-size: 28px;
        margin: 20px 0;
    }

    .error-message {
        color: red;
        /* font-size: 0.875rem; */
    }

    .hidden {
        display: none;
    }

    @@media (min-width: 1380px) {
        .progressBar li::after {
            left: 100px;
        }
    }

/* 
    .gauge {
        position: relative;
        border-radius: 50%/100% 100% 0 0;
        background-color: var(--color, #a22);
        overflow: hidden;
    }

        .gauge:before {
            content: "";
            display: block;
            padding-top: 50%; 
        }

        .gauge .chart {
            overflow: hidden;
        }

        .gauge .mask {
            position: absolute;
            left: 20%;
            right: 20%;
            bottom: 0;
            top: 40%;
            background-color: #fff;
            border-radius: 50%/100% 100% 0 0;
        }

        .gauge .percentage {
            position: absolute;
            top: -1px;
            left: -1px;
            bottom: 0;
            right: -1px;
            background-color: var(--background, #aaa);
            transform: rotate(var(--rotation));
            transform-origin: bottom center;
            transition-duration: 600;
        }

        .gauge:hover {
            --rotation: 100deg;
        }

        .gauge .value {
            position: absolute;
            bottom: 0%;
            left: 0;
            width: 100%;
            text-align: center;
        }

        .gauge .min {
            position: absolute;
            bottom: 0;
            left: 5%;
        }

        .gauge .max {
            position: absolute;
            bottom: 0;
            right: 5%;
        } 

    .text-bg-light {
        background-color: grey !important;
    }

     */

    .gauge-container {
        width: 160px;
        height: 120px;
        display: block;
        float: left;
        padding: 10px;
        /* margin: 7px; */
        border-radius: 3px;
        position: relative;
    }

    .svg-gauge {
        &__container

    {
        position: relative;
        height: 150px;
    }

    &__paths {
        /* margin: 20px auto 10px; */
        height: 80px;
        svg

    {
        fill: none;
    }

    svg path {
        transition: 0.3s;
    }

    }
    }

    .svg-gauge__paths text.label {
        fill: black;
        font-family: monospace;
        font-size: 18px;
        font-weight: bold;
        pointer-events: none;
    }

    path {
        fill: none;
    }

    .bat {
        font-size: 450%;
        display: inline-block;
        transform: rotate(270deg);
        text-align: center;
        width: 100%;
    }

    .bat-danger {
        color: red;
    }

    .bat-success {
        color: darkgreen;
    }

    table {
        border-collapse: collapse;
        /* font-family: Tahoma, Geneva, sans-serif; */
        width: 100%;
    }

        table td {
            padding: 15px;
        }

        table thead td {
            background-color: #54585d;
            color: #ffffff;
            font-weight: bold;
            font-size: 13px;
            border: 1px solid #54585d;
        }

        table tbody td {
            color: #636363;
            border: 1px solid #dddfe1;
        }

        table tbody tr {
            background-color: #f9fafb;
        }

            table tbody tr:nth-child(odd) {
                background-color: #ffffff;
            }
</style>

<div class="container-fluid">

    <div class="card card-outline ">
        <div class="card-header table-title">
            <div class="card-title">
                <h2>NEW Transfer Hub In <b></b></h2>
            </div>
            <div class="card-tools">
              @*   <button type="button" class="btn btn-danger" onclick="restartStep()">
                    NEW LOADER
                </button> *@
                <input type="checkbox" class="custom-control-input" id="chkAutoRun" />
                <label for="chkAutoRun" style="padding-right:30px;"> Auto Run </label>
                @* <button type="button" class="btn btn-success" onclick="endTask()">
                    END TASK
                </button> *@
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 col-md-3" style="padding-right:0px;padding-left:0px;">
                <div class="card-body" style="background: #f2f2f2; width:100%; height:100%;padding-right:0px;">
                    <div class="container containerDtlHistory" style="min-height:100px;">
                        @* <p>Auto Loader ID : </p>
                                <input class="form-control" type="text" id="txtHLoader" disabled>
                                <p>Lock Status : </p>
                                <input class="form-control" type="text" id="txtHLoaderLock" disabled>
                                <p>Gripper Status : </p>
                                <input class="form-control" type="text" id="txtHGripper" disabled>
                                <p>Column : </p>
                                <input class="form-control" type="text" id="txtHCol" disabled> *@
                        <div class="row">
                            <div class="col-12">
                                <p class="text-center"><span>Loader : </span> <strong id="txtHLoader">-</strong></p>
                                <br />
                                <div class="progress-group">
                                    <i class="" style="color: red;" id="icon-c1"></i>
                                    Column 1
                                    <div class="float-end" style="display: flex; flex-direction: column; align-items: flex-end; margin-bottom: 5px;">
                                        <span style="font-size: 14px; line-height: 1.2;">
                                            <b id="percent-c1">0%</b>
                                        </span>
                                        <span style="font-size: 10px; color: gray; line-height: 1.2;">
                                            <b id="balance-c1">10</b> left /<span id="colHeight-c1">10</span> mm
                                        </span>
                                    </div>
                                    <div class="progress progress-sm" style="width: 100%;">
                                        <div class="progress-bar bg-success" id="c1" role="progressbar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="progress-group mt-3">
                                    <i class="" style="color: red;" id="icon-c2"></i>
                                    Column 2
                                    <div class="float-end" style="display: flex; flex-direction: column; align-items: flex-end; margin-bottom: 5px;">
                                        <span style="font-size: 14px; line-height: 1.2;">
                                            <b id="percent-c2">0%</b>
                                        </span>
                                        <span style="font-size: 10px; color: gray; line-height: 1.2;">
                                            <b id="balance-c2">10</b> left /<span id="colHeight-c2">10</span> mm
                                        </span>
                                    </div>
                                    <div class="progress progress-sm" style="width: 100%;">
                                        <div class="progress-bar bg-success" id="c2" role="progressbar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="progress-group mt-3">
                                    <i class="" style="color: red;" id="icon-c3"></i>
                                    Column 3
                                    <div class="float-end" style="display: flex; flex-direction: column; align-items: flex-end; margin-bottom: 5px;">
                                        <span style="font-size: 14px; line-height: 1.2;">
                                            <b id="percent-c3">0%</b>
                                        </span>
                                        <span style="font-size: 10px; color: gray; line-height: 1.2;">
                                            <b id="balance-c3">10</b> left /<span id="colHeight-c3">10</span> mm
                                        </span>
                                    </div>
                                    <div class="progress progress-sm" style="width: 100%;">
                                        <div class="progress-bar bg-success" id="c3" role="progressbar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="progress-group mt-3">
                                    <i class="" style="color: red;" id="icon-c4"></i>
                                    Column 4
                                    <div class="float-end" style="display: flex; flex-direction: column; align-items: flex-end; margin-bottom: 5px;">
                                        <span style="font-size: 14px; line-height: 1.2;">
                                            <b id="percent-c4">0%</b>
                                        </span>
                                        <span style="font-size: 10px; color: gray; line-height: 1.2;">
                                            <b id="balance-c4">10</b> left /<span id="colHeight-c4">10</span> mm
                                        </span>
                                    </div>
                                    <div class="progress progress-sm" style="width: 100%;">
                                        <div class="progress-bar bg-success" id="c4" role="progressbar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <hr />
                                <div>
                                    <div style="width: 100%; display: flex; justify-content: center;" class="batteryContainer">
                                        @* <div class="gauge" style="width: 200px; --rotation:180deg; --color:#5cb85c; --background:#e9ecef;">
                                                <div class="percentage"></div>
                                                <div class="mask"></div>
                                                <span class="value"><span style="font-size:12px;">Battery : </span>100%</span>
                                            </div>*@
                                        <div class="svg-gauge svg-gauge__container gauge-container">
                                            <div class="svg-gauge__paths">
                                                <svg width="160" height="100" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M 10 80 A 65 65 0 1 1 140 80" stroke="#d3d3d3" stroke-width="13" stroke-linecap="round" />
                                                    <g id="svg-graph-meter-value"></g>
                                                    <text x="48%" y="60%" text-anchor="middle" dy="0.3em" style="font-size: 12px;">Battery</text>
                                                    <text x="48%" y="80%" text-anchor="middle" dy="0.3em" class="label" id="svg-gauge-percentage-2">90 %</text>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <span id="batteryErr" class="error-message d-flex justify-content-center align-items-center" style="font-size: 12px;"></span>
                                </div>
                                @* <div class="row">
                                    <div class="col-6" style="border-right: 1px solid lightgray;">
                                        <p class="text-center">Battery : <strong id="txtBat">-</strong></p>
                                        <div class="bat bat-success" style="width:100%;">
                                            <i class="bi bi-battery-full"></i>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <p class="text-center">Column : <strong id="txtHCol">-</strong></p>
                                        <div style="width: 100%; display: flex; justify-content: center;padding-top: 20px;">
                                            <div class="gauge" style="width: 200px; --rotation:180deg; --color:#5cb85c; --background:#e9ecef;">
                                                <div class="percentage"></div>
                                                <div class="mask"></div>
                                                <span class="value"><span style="font-size:12px;">Bal : </span> <span id="txtBal">-</span></span>
                                            </div>
                                        </div>
                                    </div>
                                </div> *@
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-12 col-md-6" style="padding-right:0px;padding-left:0px;">
                <div class="card-body" style="background: #f2f2f2; height:100%;padding-right:0px;">
                    <div class="container containerDtl" style="">
                        <ul class="progressBar">
                            <li class="active" id="step1">
                                <p>Verify Loader  </p>
                            </li>
                            <li id="step2">
                                <p>Lock <br />Loader / Gantry Ready </p>
                            </li>
                            <li id="step3">
                                <p>Empty Tray <br />Scan Reel </p>
                            </li>
                            <li id="step4">
                                <p>Place <br />Put Away </p>
                            </li>
                            <li id="stepLast">
                                <p>Finalize <br />Check Column </p>
                            </li>
                        </ul>

                        <div class="form-group" id="sec1">
                            <div class="row">
                                <h2 class="form-title">Step 1 :: Scan Loader </h2>
                                <div class=" " id="pnl1_body">
                                    <br />
                                    <div class="row">
                                        <div class="col-sm-12 col-md-4" style="text-align: center;">
                                            <img src="~/assets/img/barcode.gif" style="width:50%;" />
                                        </div>
                                        <div class="col-sm-12 col-md-8">
                                            <div class="input-group">
                                                <input class="form-control" type="text" placeholder="Scan or Insert Loader ID ... " id="txtScanLoader">
                                                <span class="input-group-text" onclick="clearLoaderScanCode()">X</span>
                                            </div>
                                            <br />
                                            <p id="pLoader1">
                                                Loader :
                                                <span class="error-message" id="err1"> </span>
                                            </p>

                                            <button class="btn btn-success" style="width:100%;" onclick="nextTo2()" id="btnNext1"> Next </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" id="sec2">
                            <div class="row">
                                <h2 class="form-title">Step 2 :: Check Flexilock and Gripper </h2>
                                <div class=" " id="pnl2_body">
                                    <br />
                                    <div class="row">
                                        <div class="col-sm-12 col-md-4" style="text-align: center;">
                                            <img src="~/assets/img/vpn.gif" style="width:50%;" />
                                        </div>
                                        <div class="col-sm-12 col-md-8">
                                            <p id="pFlexi1">
                                                Flexilock 1 :
                                                <span style="color:red; font-size:15px;" id="errFlexi1"> </span>
                                            </p>
                                            <p id="pFlexi2">
                                                Flexilock 2 :
                                                <span style="color:red; font-size:15px;" id="errFlexi2"> </span>
                                            </p>
                                            <button class="btn btn-warning" onclick="retry2a()" id="btnRetry2a" style="width:49%;">Retry Get Flexilock</button>
                                            <hr />
                                            <p id="pSetUnload">
                                                Set Unload :
                                                <span style="color:red; font-size:15px;" id="errSetUnload"> </span>
                                            </p>
                                            <button class="btn btn-danger" onclick="retry2b()" id="btnRetry2b" style="width:49%;">Retry Set </button>
                                            <div class="" id="divTurn2">
                                                <p id="pEmptyCol2">
                                                    Set Empty Column : <span style="color:red; font-size:15px;" id="errEmptyCol2"> </span>
                                                </p>
                                                <p id="pStatusReady2">
                                                    Status Ready to Turn Column : <span style="color:red; font-size:15px;" id="errStatusReady2"> </span>
                                                </p>
                                                <p id="pTurn2">
                                                    Turn Column : <span style="color:red; font-size:15px;" id="errTurn2"> </span>
                                                </p>
                                                <button class="btn btn-danger" onclick="retry2SetEmpty()" id="btnRetry2SetEmpty" style="width:49%;">Retry Set Empty</button>
                                                <button class="btn btn-warning" onclick="retry2ReadyStatus()" id="btnRetry2ReadyStatus" style="width:49%;">Retry Ready Status</button>
                                                <button class="btn btn-danger" onclick="retry2Turn()" id="btnRetry2Turn" style="width:49%;">Retry Turn</button>
                                            </div>
                                            <hr />
                                            <p id="pLoaderFork">
                                                Fork Status :
                                                <span style="color:red; font-size:15px;" id="errLoaderFork2"> </span>
                                            </p>
                                            <p id="pGripper2">
                                                Gantry Status :
                                                <span style="color:red; font-size:15px;" id="errGripper2"> </span>
                                            </p>
                                            <p id="pCol2">
                                                Column Ready :
                                                <span style="color:red; font-size:15px;" id="errCol2"> </span>
                                            </p>
                                            <button class="btn btn-warning" onclick="retry2c()" id="btnRetry2c" style="width:49%;">Retry</button>
                                            <button class="btn btn-success" style="width:49%;" onclick="nextTo3()" id="btnNext2"> Next </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" id="sec3">
                            <div class="row">
                                <h2 class="form-title">Step 3 :: Get Empty Tray And Reel </h2>
                                <div class=" " id="pnl3_body">
                                    <br />
                                    <div class="row">
                                        <div class="col-sm-12 col-md-4" style="text-align: center;">
                                            <img src="~/assets/img/3d-scanning.gif" style="width:50%;" />
                                        </div>
                                        <div class="col-sm-12 col-md-8">
                                            <p id="pETray3">
                                                Empty Tray Slot :
                                                <span style="color:red; font-size:15px;" id="errETray3"> </span>
                                            </p>
                                            <p id="pGetTray3">
                                                Get Tray Status :
                                                <span style="color:red; font-size:15px;" id="errGetTray3"> </span>
                                            </p>
                                            <button class="btn btn-danger" onclick="retry3a1()" id="btnRetry3a1" style="width:49%;">Retry Take Tray</button>
                                            <button class="btn btn-warning" onclick="retry3a2()" id="btnRetry3a2" style="width:49%;">Retry Get Tray Status</button>
                                            <hr />
                                            <p id="pReel3">
                                                Reel :
                                                <span style="color:red; font-size:15px;" id="errReel3"> </span>
                                            </p>
                                            <p id="pItem3" class="hidden">
                                                Item :
                                                <span style="color:red; font-size:15px;" id="errItem3"> </span>
                                            </p>
                                            <p id="pActHeight3" class="hidden">
                                                Actual Height :
                                                <span style="color:red; font-size:15px;" id="errActHeight3"> </span>
                                            </p>
                                            <p id="pGetReel3">
                                                Retrieve Reel Status :
                                                <span style="color:red; font-size:15px;" id="errGetReel3"> </span>
                                            </p>
                                            <p id="pPick3">
                                                Pick Status :
                                                <span style="color:red; font-size:15px;" id="errPick3"> </span>
                                            </p>
                                            <button class="btn btn-danger" onclick="retry3b()" id="btnRetry3b" style="width:49%;">Retry Scan</button>
                                            <button class="btn btn-danger" onclick="retry3c()" id="btnRetry3c" style="width:49%;">Retry Get Reel Info</button>
                                            <button class="btn btn-danger" onclick="retry3d()" id="btnRetry3d" style="width:49%;">Retry Set Actual Height</button>
                                            <button class="btn btn-warning" onclick="retry3e()" id="btnRetry3e" style="width:49%;">Retry Pick</button>
                                            <button class="btn btn-success" style="width:100%;" onclick="nextTo4()" id="btnNext3"> Next </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" id="sec4">
                            <div class="row">
                                <h2 class="form-title">Step 4 :: Scan Reel and Put Away </h2>
                                <div class=" " id="pnl4_body">
                                    <br />
                                    <div class="row">
                                        <div class="col-sm-12 col-md-4" style="text-align: center;">
                                            <img src="~/assets/img/shower-tray.gif" style="width:50%;" />
                                        </div>
                                        <div class="col-sm-12 col-md-8">
                                            <p id="pSlot4">
                                                Slot Code : <span style="color:red; font-size:15px;" id="errSlot4"> </span>
                                            </p>
                                            <p id="pSlotTake4">
                                                Slot Reserve : <span style="color:red; font-size:15px;" id="errSlotTake4"> </span>
                                            </p>
                                            <button class="btn btn-warning" onclick="retry4a()" id="btnRetry4a" style="width:49%;">Retry Get Slot</button>
                                            <hr />
                                            <p id="pPlace4">
                                                Place to Tray Status : <span style="color:red; font-size:15px;" id="errPlace4"> </span>
                                            </p>
                                            <button class="btn btn-danger" onclick="retry4b1()" id="btnRetry4b1" style="width:49%;">Retry Place</button>
                                            <button class="btn btn-warning" onclick="retry4b2()" id="btnRetry4b2" style="width:49%;">Retry Place Status</button>
                                            <hr />
                                            <p id="pPutAway4">
                                                Put Away Status : <span style="color:red; font-size:15px;" id="errPutAway4"> </span>
                                            </p>
                                            <button class="btn btn-danger" onclick="retry4c1()" id="btnRetry4c1" style="width:49%;">Retry Put Away</button>
                                            <button class="btn btn-warning" onclick="retry4c2()" id="btnRetry4c2" style="width:49%;">Retry Put Away Status</button>
                                            <button class="btn btn-success" style="width:49%;" onclick="nextTo5()" id="btnNext4"> Next </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" id="secLast">
                            <div class="row form-group-row">
                                <h2 class="form-title">Step 5 :: Finalizing </h2>
                                <div class=" " id="pnlLast_body">
                                    <br />
                                    <div class="row">
                                        <div class="col-sm-12 col-md-4" style="text-align: center;">
                                            <img src="~/assets/img/padlock.gif" style="width:50%;" />
                                        </div>
                                        <div class="col-sm-12 col-md-8">
                                            <p style="text-align:center;" id="pTextLast">Waiting finish loading reel ...</p>

                                            <button class="btn btn-warning" onclick="retryLast()" id="btnRetryLast" style="width:49%;">Retry Save</button>
                                            <button class="btn btn-warning" onclick="retryLastET()" id="btnRetryLastET" style="width:49%;">Retry End Task</button>

                                            <button class="btn btn-danger" style="width:49%;" onclick="tempEndTask()" id="btnTempEndTask">Temp End Task </button>

                                            <div class="" id="divTurn">
                                                <hr />
                                                <p id="pEmptyColLast">
                                                    Set Empty Column : <span style="color:red; font-size:15px;" id="errEmptyColLast"> </span>
                                                </p>
                                                <p id="pStatusReadyLast">
                                                    Status Ready to Turn Column : <span style="color:red; font-size:15px;" id="errStatusReadyLast"> </span>
                                                </p>
                                                <p id="pTurnLast">
                                                    Turn Column : <span style="color:red; font-size:15px;" id="errTurnLast"> </span>
                                                </p>
                                                <button class="btn btn-danger" onclick="retryLastSetEmpty()" id="btnRetryLastSetEmpty" style="width:49%;">Retry Set Empty</button>
                                                <button class="btn btn-warning" onclick="retryLastReadyStatus()" id="btnRetryLastReadyStatus" style="width:49%;">Retry Ready Status</button>
                                                <button class="btn btn-danger" onclick="retryLastTurn()" id="btnRetryLastTurn" style="width:49%;">Retry Turn</button>
                                                <button class="btn btn-danger" onclick="retryLastSetEmpty2()" id="btnRetryLastSetEmpty2" style="width:49%;">Retry Empty All</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <input type="hidden" id="txtLoaderId">
                    <input type="hidden" id="txtLoaderCode">
                    <input type="hidden" id="txtReelId">
                    <input type="hidden" id="txtReelCode">
                    <input type="hidden" id="txtActHeight">
                    <input type="hidden" id="txtICol">
                    <input type="hidden" id="txtSetUnload">

                    <input type="hidden" id="txtStep2a">
                    <input type="hidden" id="txtStep2b">
                    <input type="hidden" id="txtStep2c">
                    <input type="hidden" id="txtStep3a">
                    <input type="hidden" id="txtStep3b">
                    <input type="hidden" id="txtStep3c">
                    <input type="hidden" id="txtStep3d">
                    <input type="hidden" id="txtStep3e">
                    <input type="hidden" id="txtStep4a">
                    <input type="hidden" id="txtStep4b">
                    <input type="hidden" id="txtStep4c">
                    <input type="hidden" id="txtStep4d">

                    <input type="hidden" id="txtCol1TotalReels">
                    <input type="hidden" id="txtCol2TotalReels">
                    <input type="hidden" id="txtCol3TotalReels">
                    <input type="hidden" id="txtCol4TotalReels">

                    <input type="hidden" id="txtTempEndTask">
                    <input type="hidden" id="txtDone">
                </div>
            </div>
            <div class="col-sm-12 col-md-3" style="padding-right:0px;padding-left:0px;">
                <div class="card-body" style="background: #f2f2f2; width:100%; height:100%;">
                    <div class="container containerDtlHistory" style="min-height:50px; padding-bottom: 50px;">
                        <p class="text-center"><span>Reel : </span> <strong id="txtHReel">-</strong></p>
                        <br />
                        <p>Empty Tray : </p>
                        <input class="form-control" type="text" id="txtHEmpty" disabled>
                        @* <p>Reel : </p>
                        <input class="form-control" type="text" id="txtHReel" disabled> *@
                        <p>Item : </p>
                        <input class="form-control" type="text" id="txtHItem" disabled>
                        <p>Act. Height : </p>
                        <input class="form-control" type="text" id="txtHActH" disabled>
                        <p>To Slot : </p>
                        <input class="form-control" type="text" id="txtHSlot" disabled>
                        <p>Slot Take : </p>
                        <input class="form-control" type="text" id="txtHSlotTake" disabled>
                        @* <table style="">
                            <tbody>
                                <tr>
                                    <td>
                                        <p>Empty Tray</p>
                                    </td>
                                    <td>
                                        <p id="txtHEmpty"></p>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <p>Item</p>
                                    </td>
                                    <td>
                                        <p id="txtHItem"></p>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <p>Act. Height</p>
                                    </td>
                                    <td>
                                        <p id="txtHActH"></p>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <p>To Slot</p>
                                    </td>
                                    <td>
                                        <p id="txtHSlot"></p>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <p>Slot Take</p>
                                    </td>
                                    <td>
                                        <p id="txtHSlotTake"></p>
                                    </td>
                                </tr>
                            </tbody>
                        </table> *@
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<div class="modal fade" id="warnTurnModal" role="dialog" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-body" style="padding: 50px;">
                <div class="row">
                    <div class="col-6">
                        <img src="~/assets/img/a-b.gif" style="width:100%;" />
                    </div>
                    <div class="col-6">
                        <p class="" style="font-size:2em;">Please make sure hands off and tap Start Turn Column button.</p>
                        <button class="btn btn-success" style="width: 100%; height: 150px;" onclick="turnCol(1)">Start Turn Column</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts
{ 
    <link href="~/css/datatables.min.css" rel="stylesheet">
    <link rel="stylesheet" href="~/css/sweetalert2.min.css">

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
        <script src="~/js/datatables.min.js"></script>
    <script src="~/js/sweetalert2.all.min.js"></script>

    <script type="text/javascript">

        const scanLoaderEle = document.getElementById('txtScanLoader');

        scanLoaderEle.addEventListener('keyup', function(event) {
          // Check if the pressed key is "Enter" (key code 13 or key property "Enter")
          if (event.key === 'Enter') {

            const inputValue = this.value;
            if (inputValue == "") { return; }

            var code = inputValue;
            addLoader(0, code);
          }
        });

        $(document).ready(function () {

            $("#txtSetUnload").val('0');
            $("#txtICol").val('1');

            resetColorPLCForm(1);
            // $('#divTurn2').removeClass("hidden");
            // $("#txtLoaderId").val('2');
            // $("#txtReelId").val('08E80675-3D9B-4622-E0B8-08DDEF6E5195');
            // $("#txtHSlot").val('00M01C001R018');
            // $("#txtHSlotTake").val('2');
            // loadPLC(5);
            $("#txtTempEndTask").val('0');
            $("#txtDone").val('0');

            initialGaugeSetup(
                "svg-graph-meter-value",
                "svg-gauge-percentage-2",
                "rgb(228, 0, 0)",
                0,
                setGaugePathValue
            );
        });

        function initialGaugeSetup(
            gaugeElementId,
            percentId,
            meterColor,
            initialValue,
            setGaugeValueCallback
        ) {
            const gaugeElement = document.getElementById(gaugeElementId);
            const percentageElement = document.getElementById(percentId);

            percentageElement.textContent = initialValue + " %";
            setGaugeValueCallback(gaugeElement, initialValue, meterColor);

            percentageElement.addEventListener("change", (event) =>
                percentageChangedEvent(
                    gaugeElement,
                    event.target.value,
                    meterColor,
                    setGaugeValueCallback
                )
            );
        }

        percentageChangedEvent = (
            gauge,
            newPercentage,
            color,
            setGaugeValueCallback
        ) => {
            const percentage =
            newPercentage > 100 ? 100 : newPercentage < 0 ? 0 : newPercentage;
            setGaugeValueCallback(gauge, 80, color);
        };

        function setGaugePathValue(gaugeElement, percentage, color) {
            const gaugeRadius = 65;
            const startingY = 80;
            const startingX = 10;

            const zeroBasedY = gaugeRadius * Math.sin(percentageInRadians(percentage));
            const y = -zeroBasedY + startingY;
            const zeroBasedX = gaugeRadius * Math.cos(percentageInRadians(percentage));
            const x = -zeroBasedX + gaugeRadius + startingX;
            // console.log(
            // `percentage: ${percentage}, zeroBasedY: ${zeroBasedY}, y: ${y}, zeroBasedX: ${zeroBasedX}, x: ${x}`
            // );

            gaugeElement.innerHTML = `<path d="M ${startingX} ${startingY}
                A ${gaugeRadius} ${gaugeRadius} 0 0 1 ${x} ${y}"
                stroke="${color}" stroke-width="13" stroke-linecap="round" />`;
        }

        function percentageInRadians(percentage) {
            return percentage * (Math.PI / 100);
        }

        function startBatteryMonitoring(loaderId) {
            getBattery(loaderId);
            setInterval(() => getBattery(loaderId), 100000);
        }

        function getBattery(loaderId) {
            $.ajax({
                url: "/api/PLCLoader/GetBatteryStatus/" + loaderId,
                type: "GET",
                dataType: 'JSON',
                contentType: 'application/json; charset=utf-8',
                success: function (result) {
                    if (result.success == true) {
                        const battery = result.data;
                        const meterColor = getBatteryColor(battery);
                        updateBatteryGauge(battery, meterColor);
                    }
                    else
                    {
                        //failed to get loader battery
                        $('#batteryErr').text('Battery Status Unavailable').css('');
                    }
                },
                error: function (error) {

                }
            });
        }

        function getBatteryColor(battery) {
            if (battery > 60) {
                return "#4CAF50";
            } else if (battery >= 30) {
                return "#FEB21A";
            } else {
                return "#F44336";
            }
        }

        function updateBatteryGauge(battery, meterColor) {
            const gaugeElement = document.getElementById("svg-graph-meter-value");
            const percentageElement = document.getElementById("svg-gauge-percentage-2");

            percentageElement.textContent = battery + " %";
            setGaugePathValue(gaugeElement, battery, meterColor);
        }

        function addLoader(_type, code) {
            $.ajax({
                url: "/api/PLCHubIn/GetLoaderInfo_PendingToUnLoad/" + code,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {
                    Swal.fire({
                        text: 'Please Wait',
                        width: '300px',

                        allowEscapeKey: false,
                        allowOutsideClick: false,
                        showConfirmButton: false,
                    });
                    Swal.showLoading()
                },
                success: function (result) {
                    // console.log(result);
                    swal.close();
                    if (result.success == true) {
                        // continue
                        $("#txtLoaderId").val(result.data.loader_Id);
                        $("#txtLoaderCode").val(result.data.loaderCode);

                        // loadPLC(1);
                        resetColorPLCForm(1);
                        startBatteryMonitoring(result.data.loader_Id);

                        $("#txtHLoader").html(result.data.loaderCode);
                        $('#btnNext1').removeClass("hidden");

                        $("#txtCol1TotalReels").val(result.data.col1TotalReels);
                        $("#txtCol2TotalReels").val(result.data.col2TotalReels);
                        $("#txtCol3TotalReels").val(result.data.col3TotalReels);
                        $("#txtCol4TotalReels").val(result.data.col4TotalReels);

                        $(`#percent-c1`).text(`${result.data.col1UsedPercentage}%`);
                        $(`#balance-c1`).text(`${result.data.col1TotalReels}`);
                        $(`#colHeight-c1`).text(`${result.data.colHeight}`);
                        $(`#c1`).css('width', `${result.data.col1UsedPercentage}%`);

                        $(`#percent-c2`).text(`${result.data.col2UsedPercentage}%`);
                        $(`#balance-c2`).text(`${result.data.col2TotalReels}`);
                        $(`#colHeight-c2`).text(`${result.data.colHeight}`);
                        $(`#c2`).css('width', `${result.data.col2UsedPercentage}%`);
                        
                        $(`#percent-c3`).text(`${result.data.col3UsedPercentage}%`);
                        $(`#balance-c3`).text(`${result.data.col3TotalReels}`);
                        $(`#colHeight-c3`).text(`${result.data.colHeight}`);
                        $(`#c3`).css('width', `${result.data.col3UsedPercentage}%`);

                        $(`#percent-c4`).text(`${result.data.col4UsedPercentage}%`);
                        $(`#balance-c4`).text(`${result.data.col4TotalReels}`);
                        $(`#colHeight-c4`).text(`${result.data.colHeight}`);
                        $(`#c4`).css('width', `${result.data.col4UsedPercentage}%`);


                        $('#pLoader1').html('Loader : ' + result.data.loaderCode + ' <span class="error-message" id="err1"></span>');
                    }
                    else {
                        $('#pLoader1').html('Loader :  <span class="error-message" id="err1">' + result.errMessage + '</span>');
                    }
                },
                error: function (error) {
                    $('#pLoader1').html('Loader :  <span class="error-message" id="err1">' + error.val + '</span>');
                }
            });
        }

        function restartStep() {
            resetColorPLCForm(1);

            $("#txtScanLoader").val('');
            $('#pLoader1').html('Loader : <span class="error-message" id="err1"> </span>');

            $("#txtLoaderId").val('');
            $("#txtLoaderCode").val('');
            $("#txtReelId").val('');
            $("#txtReelCode").val('');
            $("#txtActHeight").val(0);
            $("#txtICol").val(1);
            $("#txtStep2a").val('');
            $("#txtStep2b").val('');
            $("#txtStep3").val('');
            $("#txtStep4").val('');

            $("#txtCol1TotalReels").val('0');
            $("#txtCol2TotalReels").val('0');
            $("#txtCol3TotalReels").val('0');
            $("#txtCol4TotalReels").val('0');

            $("#txtHLoader").html('');
            // $("#txtHLoaderLock").val('');
            // $("#txtHGripper").val('');
            // $("#txtHCol").html('');

            $("#txtHEmpty").val('');
            $("#txtHReel").html('-');
            $("#txtHItem").val('');
            $("#txtHActH").val('');
            $("#txtHSlot").val('');
            $("#txtHSlotTake").val('');

            scanLoaderEle.focus();

            initialGaugeSetup(
                "svg-graph-meter-value",
                "svg-gauge-percentage-2",
                "rgb(228, 0, 0)",
                0,
                setGaugePathValue
            );

        }

        function nextReel() {
            var d = $("#txtDone").val();
            if (d == "1" || d == "2") {
                return;
            }
            nextTo2();
        }

        function resetColorPLCForm(idx) {
            $("#sec1").removeClass("form-active");
            $("#sec2").removeClass("form-active");
            $("#sec3").removeClass("form-active");
            $("#sec4").removeClass("form-active");
            $("#secLast").removeClass("form-active");

            $("#step1").removeClass("next");
            $("#step2").removeClass("next");
            $("#step3").removeClass("next");
            $("#step4").removeClass("next");
            $("#stepLast").removeClass("next");

            $("#step1").removeClass("active");
            $("#step2").removeClass("active");
            $("#step3").removeClass("active");
            $("#step4").removeClass("active");
            $("#stepLast").removeClass("active");

            $('#btnRetry2a').addClass("hidden");
            $('#btnRetry2b').addClass("hidden");
            $('#btnRetry2c').addClass("hidden");
            $('#btnRetry3a1').addClass("hidden");
            $('#btnRetry3a2').addClass("hidden");
            $('#btnRetry3b').addClass("hidden");
            $('#btnRetry3c').addClass("hidden");
            $('#btnRetry3d').addClass("hidden");
            $('#btnRetry3e').addClass("hidden");
            $('#btnRetry4a').addClass("hidden");
            $('#btnRetry4b1').addClass("hidden");
            $('#btnRetry4b2').addClass("hidden");
            $('#btnRetry4c1').addClass("hidden");
            $('#btnRetry4c2').addClass("hidden");
            $('#btnRetryLast').addClass("hidden");
            $('#btnRetryLastET').addClass("hidden");

            $('#btnRetryLastSetEmpty').addClass("hidden");
            $('#btnRetryLastReadyStatus').addClass("hidden");
            $('#btnRetryLastTurn').addClass("hidden");
            $('#divTurn').addClass("hidden");

            $('#divTurn2').addClass("hidden");
            $('#btnRetry2SetEmpty').addClass("hidden");
            $('#btnRetry2ReadyStatus').addClass("hidden");
            $('#btnRetry2Turn').addClass("hidden");

            $('#btnRetryLastSetEmpty2').addClass("hidden");
            
            $('#btnNext1').addClass("hidden");
            $('#btnNext2').addClass("hidden");
            $('#btnNext3').addClass("hidden");
            $('#btnNext4').addClass("hidden");

            $('#btnTempEndTask').addClass("hidden");
            

            if (idx == 1) {
                // const col1 = document.getElementById("col1");
                // col1.style.width = "0%";
                // const col2 = document.getElementById("col2");
                // col2.style.width = "0%";
                // const col3 = document.getElementById("col3");
                // col3.style.width = "0%";
                // const col4 = document.getElementById("col4");
                // col4.style.width = "0%";
                // $("#txtBat").html('-');
                // $("#txtBal").html('-');

                // $("#txtCol1TotalReels").val('0');
                // $("#txtCol2TotalReels").val('0');
                // $("#txtCol3TotalReels").val('0');
                // $("#txtCol4TotalReels").val('0');

                $("#sec1").addClass("form-active");
                $("#step1").addClass("active");

                $('#err1').html("");
            }
            else if (idx == 2) {
                $("#sec2").addClass("form-active");
                $("#step1").addClass("next");
                $("#step1").addClass("active");
                $("#step2").addClass("active");

                $('#err2').html("");
            }
            else if (idx == 3) {
                $("#sec3").addClass("form-active");
                $("#step1").addClass("next");
                $("#step2").addClass("next");
                $("#step1").addClass("active");
                $("#step2").addClass("active");
                $("#step3").addClass("active");

                $('#errCol3').html("");
                $('#errFork3').html("");
            }
            else if (idx == 4) {
                $("#sec4").addClass("form-active");
                $("#step1").addClass("next");
                $("#step2").addClass("next");
                $("#step3").addClass("next");
                $("#step1").addClass("active");
                $("#step2").addClass("active");
                $("#step3").addClass("active");
                $("#step4").addClass("active");

                $('#err4').html("");
            }
            else if (idx == 0) {
                //
            }
            else {
                $("#secLast").addClass("form-active");
                $("#step1").addClass("next");
                $("#step2").addClass("next");
                $("#step3").addClass("next");
                $("#step4").addClass("next");
                $("#step1").addClass("active");
                $("#step2").addClass("active");
                $("#step3").addClass("active");
                $("#step4").addClass("active");
                $("#stepLast").addClass("active");

                $('#err5').html("");
            }

        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function nextTo2() {
            var loaderId = $("#txtLoaderId").val();
            if (loaderId == "") {
                $('#pLoader1').html('Loader : <span class="error-message" id="err1"> Must select Auto Loader </span>');
                return;
            }
            var loaderCode = $("#txtLoaderCode").val();
            var scanCode = $("#txtScanLoader").val();
            if (loaderCode.toUpperCase() != scanCode.toUpperCase()) {
                $('#pLoader1').html('Loader : <span class="error-message" id="err1"> Please rescan the Loader </span>');
                return;
            }

            resetColorPLCForm(2);
            $("#txtReelId").val('');
            $("#txtReelCode").val('');
            $("#txtActHeight").val(0);
            $("#txtStep2a").val('');
            $("#txtStep2b").val('');
            $("#txtStep2c").val('');
            $("#txtStep3a").val('');
            $("#txtStep3b").val('');
            $("#txtStep3c").val('');
            $("#txtStep3d").val('');
            $("#txtStep3e").val('');
            $("#txtStep4a").val('');
            $("#txtStep4b").val('');
            $("#txtStep4c").val('');
            $("#txtTempEndTask").val('0');

            $('#pFlexi1').html('Flexilock 1 : <span class="error-message" id="errFlexi1"></span>');
            $('#pFlexi2').html('Flexilock 2 : <span class="error-message" id="errFlexi2"></span>');
            $('#pSetUnload').html('Set Unload : <span class="error-message" id="errSetUnload"></span>');
            $('#pLoaderFork').html('Fork Status : <span class="error-message" id="errLoaderFork2"></span>');
            $('#pGripper2').html('Gantry Status : <span class="error-message" id="errGripper2"></span>');
            $('#pCol2').html('Column Ready : <span class="error-message" id="errCol2"></span>');
            
            $('#pEmptyColLast').html('Set Empty Column : <span class="error-message" id="errEmptyColLast"> </span>');
            $('#pEmptyCol2').html('Set Empty Column : <span class="error-message" id="errEmptyCol2"> </span>');
						
            $('#pStatusReadyLast').html('Status Ready to Turn Column : <span class="error-message" id="errStatusReadyLast"> </span>');
            $('#pStatusReady2').html('Status Ready to Turn Column : <span class="error-message" id="errStatusReady2"> </span>');
						
            $('#pTurnLast').html('Turn Column : <span class="error-message" id="errTurnLast"> </span>');
            $('#pTurn2').html('Turn Column : <span class="error-message" id="errTurn2"> </span>');

            // $("#txtHLoaderLock").val('');
            // $("#txtHGripper").val('');
            // $("#txtHCol").html('');

            $("#txtHEmpty").val('');
            $("#txtHItem").val('');
            $("#txtHActH").val('');
            $("#txtHSlot").val('');
            $("#txtHSlotTake").val('');

            loadPLC(21);
        }

        function nextTo3() {
            var step2a = $("#txtStep2a").val();
            var step2b = $("#txtStep2b").val();
            var step2c = $("#txtStep2c").val();
            if (step2a != "OK" || step2b != "OK" || step2c != "OK") {
                return;
            }

            resetColorPLCForm(3);
            $('#pETray3').html('Empty Tray Slot : <span class="error-message" id="errETray3"></span>');
            $('#pGetTray3').html('Get Tray Status : <span class="error-message" id="errGetTray3"></span>');

            $('#pReel3').html('Reel : <span class="error-message" id="errReel3"></span>');
            $('#pItem3').html('Item : <span class="error-message" id="errItem3"></span>');
            $('#pActHeight3').html('Actual Height : <span class="error-message" id="errActHeight3"></span>');
            $('#pGetReel3').html('Retrieve Reel Status : <span class="error-message" id="errGetReel3"></span>');
            $('#pPick3').html('Pick Status : <span class="error-message" id="errPick3"></span>');

            $("#txtHEmpty").val('');
            $("#txtHItem").val('');
            $("#txtHActH").val('');
            $("#txtHSlot").val('');
            $("#txtHSlotTake").val('');

            $("#txtReelId").val('');
            $("#txtReelCode").val('');
            $("#txtActHeight").val('');

            loadPLC(3);
        }

        function nextTo4() {
            var step3a = $("#txtStep3a").val();
            var step3b = $("#txtStep3b").val();
            if (step3a != "OK" || step3b != "OK") {
                return;
            }

            resetColorPLCForm(4);
            $('#pSlot4').html('Slot Code : <span class="error-message" id="errSlot4"></span>');
            $('#pSlotTake4').html('Slot Reserve: <span class="error-message" id="errSlotTake4"></span>');

            $('#pPlace4').html('Place to Tray Status : <span class="error-message" id="errPlace4"></span>');
            $('#pPutAway4').html('Put Away Status : <span class="error-message" id="errPutAway4"></span>');

            loadPLC(4);
        }

        function nextTo5() {
            var step4a = $("#txtStep4a").val();
            var step4b = $("#txtStep4b").val();
            var step4c = $("#txtStep4c").val();
            if (step4a != "OK" || step4b != "OK" || step4c != "OK") {
                return;
            }

            resetColorPLCForm(5);
            loadPLC(5);
        }

        function retry2a() {
            $('#btnRetry2a').addClass("hidden");
            $('#btnRetry2b').addClass("hidden");
            loadPLC(21);
        }

        function retry2b() {
            $('#btnRetry2b').addClass("hidden");
            loadPLC(22);
        }

        function retry2c() {
            $('#btnRetry2c').addClass("hidden");
            loadPLC(23);
        }

        function retry3a1() {
            $('#btnRetry3a1').addClass("hidden");
            loadPLC(30);
        }

        function retry3a2() {
            $('#btnRetry3a2').addClass("hidden");
            loadPLC(31);
        }

        function retry3b() {
            $('#btnRetry3b').addClass("hidden");
            loadPLC(33);
        }
        
        function retry3c() {
            $('#btnRetry3c').addClass("hidden");
            loadPLC(34);
        }

        function retry3d() {
            $('#btnRetry3d').addClass("hidden");
            loadPLC(35);
        }
        
        function retry3e() {
            $('#btnRetry3e').addClass("hidden");
            loadPLC(32);
        }

        function retry4a() {
            $('#btnRetry4a').addClass("hidden");
            loadPLC(41);
        }

        function retry4b1() {
            $('#btnRetry4b1').addClass("hidden");
            loadPLC(42);
        }

        function retry4b2() {
            $('#btnRetry4b2').addClass("hidden");
            loadPLC(45);
        }

        function retry4c1() {
            $('#btnRetry4c1').addClass("hidden");
            loadPLC(43);
        }

        function retry4c2() {
            $('#btnRetry4c2').addClass("hidden");
            loadPLC(44);
        }

        function retryLast() {
            $('#btnRetryLast').addClass("hidden");
            loadPLC(5);
        }

        function retryLastET() {
            $('#btnRetryLastET').addClass("hidden");
            loadPLC(51);
        }

        function retryLastSetEmpty() {
            $('#btnRetryLastSetEmpty').addClass("hidden");
            loadPLC(52);
        }

        function retryLastSetEmpty2() {
            $('#btnRetryLastSetEmpty2').addClass("hidden");
            loadPLC(55);
        }
               
        function retryLastReadyStatus() {
            $('#btnRetryLastReadyStatus').addClass("hidden");
            loadPLC(53);
        }

        function retryLastTurn() {
            $('#btnRetryLastTurn').addClass("hidden");
            loadPLC(54);
        }

        function retry2SetEmpty() {
            $('#btnRetry2SetEmpty').addClass("hidden");
            turnColFirst(1);
        }

        function retry2ReadyStatus() {
            $('#btnRetry2ReadyStatus').addClass("hidden");
            turnColFirst(2);
        }

        function retry2Turn() {
            $('#btnRetry2Turn').addClass("hidden");
            turnColFirst(3);
        }

        function updateLoaderInfo() {

            var code = $("#txtLoaderCode").val();

            $.ajax({
                url: "/api/PLCHubIn/GetLoaderInfo_PendingToUnLoad/" + code,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                success: function (result) {
                    // console.log(result);
                    if (result.success == true) {
                        $("#txtCol1TotalReels").val(result.data.col1TotalReels);
                        $("#txtCol2TotalReels").val(result.data.col2TotalReels);
                        $("#txtCol3TotalReels").val(result.data.col3TotalReels);
                        $("#txtCol4TotalReels").val(result.data.col4TotalReels);

                        $(`#percent-c1`).text(`${result.data.col1UsedPercentage}%`);
                        $(`#balance-c1`).text(`${result.data.col1TotalReels}`);
                        $(`#colHeight-c1`).text(`${result.data.colHeight}`);
                        $(`#c1`).css('width', `${result.data.col1UsedPercentage}%`);

                        $(`#percent-c2`).text(`${result.data.col2UsedPercentage}%`);
                        $(`#balance-c2`).text(`${result.data.col2TotalReels}`);
                        $(`#colHeight-c2`).text(`${result.data.colHeight}`);
                        $(`#c2`).css('width', `${result.data.col2UsedPercentage}%`);
                        
                        $(`#percent-c3`).text(`${result.data.col3UsedPercentage}%`);
                        $(`#balance-c3`).text(`${result.data.col3TotalReels}`);
                        $(`#colHeight-c3`).text(`${result.data.colHeight}`);
                        $(`#c3`).css('width', `${result.data.col3UsedPercentage}%`);

                        $(`#percent-c4`).text(`${result.data.col4UsedPercentage}%`);
                        $(`#balance-c4`).text(`${result.data.col4TotalReels}`);
                        $(`#colHeight-c4`).text(`${result.data.colHeight}`);
                        $(`#c4`).css('width', `${result.data.col4UsedPercentage}%`);
                    }
                    else {
                        $("#txtCol1TotalReels").val(0);
                        $("#txtCol2TotalReels").val(0);
                        $("#txtCol3TotalReels").val(0);
                        $("#txtCol4TotalReels").val(0);
                    }
                },
                error: function (error) {
                    $("#txtCol1TotalReels").val(0);
                    $("#txtCol2TotalReels").val(0);
                    $("#txtCol3TotalReels").val(0);
                    $("#txtCol4TotalReels").val(0);
                }
            });

        }

        async function tempEndTask() {
            var loaderId = $("#txtLoaderId").val();
            $("#txtTempEndTask").val('1');
            $('#pTextLast').html("Loader temp End Task...");

            var chkEnd = await loadPLCTempEndTask(loaderId, true);
            console.log('R11::' + chkEnd);
            if (chkEnd == false) {
                $("#txtTempEndTask").val('0');

            }
            return;
        }

        async function turnColFirst(idx) {
            var fResult = false;

            $('#divTurn2').removeClass("hidden");
            var loaderId = $("#txtLoaderId").val();
            var iCol = $("#txtICol").val();

            var bal = $("#txtCol1TotalReels").val();
            if (Number(iCol) == 2) { bal = $("#txtCol2TotalReels").val(); }
            if (Number(iCol) == 3) { bal = $("#txtCol3TotalReels").val(); }
            if (Number(iCol) == 4) { bal = $("#txtCol4TotalReels").val(); }
            // $('#txtBal').html(bal);

            if (bal > 0) {
                return true;
            }
            else {
                var nextCol = 2;
                if (Number($("#txtCol4TotalReels").val()) > 0) { nextCol = 4; }
                if (Number($("#txtCol3TotalReels").val()) > 0) { nextCol = 3; }
                if (Number($("#txtCol2TotalReels").val()) > 0) { nextCol = 2; }

                if (Number(iCol) < Number(nextCol)) {

                    var setE = true;
                    if (idx <= 1) {
                        setE = await loadPLCSetColumnEmpty(loaderId, Number(iCol));
                    }
                    if (setE == false) {
                        $('#btnRetry2SetEmpty').removeClass("hidden");
                        return fResult;
                    }

                    var getR = true;
                    if (idx <= 2) {
                        await delay(8000);
                        getR = await loadPLCReadyStatus(loaderId);
                    }
                    if (getR == false) {
                        $('#btnRetry2ReadyStatus').removeClass("hidden");
                        return fResult;
                    }

                    var getT = true;
                    if (idx <= 3) {
                        getT = await loadPLCTurn(loaderId, Number(nextCol));
                    }
                    if (getT == false) {
                        $('#btnRetry2Turn').removeClass("hidden");
                    }
                    else {
                        var delayT = 5000 * (nextCol - 1);
                        await delay(delayT);

                        var chkGripper2 = await loadPLCCheckUnlodingStatus(loaderId);
                        console.log('R2.32::' + chkGripper2);
                        if (chkGripper2 == true) {
                            if (idx > 0) {
                                loadPLC(24);
                            }
                            return true;
                        }
                        else {
                            $('#btnRetry2c').removeClass("hidden");
                            return fResult;
                        }
                    }
                }

            }
        }

        async function loadPLC(idx) {

            var loaderId = $("#txtLoaderId").val();

            // step 1 : check loader
            // if (idx == 1) {
            //     resetColorPLCForm(1);
            //     if (loaderId == "") {
            //         $('#pLoader1').html("Loader : ");
            //         $('#err1').html("No loader is selected.");
            //         return;
            //     }

            //     // await delay(3000);
            //     var chkLoader = await loadPLCCheckLoader(loaderId);
            //     console.log('R1::' + chkLoader);
            //     if (chkLoader == true) {
            //         startBatteryMonitoring(loaderId);
            //         // getLoaderColumn(loaderId);  //get loader column usage and show status
            //     }
            //     return;
            // }
            

            // step 2 : check flexilock and gripper
            if (idx == 21) {
                var chkFlex = await loadPLCCheckFlexilock();
                console.log('R2.1::' + chkFlex);
                if (chkFlex == true) {
                    $("#txtStep2a").val('OK');
                    idx = 22;
                }
                else {
                    $('#btnRetry2a').removeClass("hidden");
                    return;
                }
            }
            if (idx == 22) {
                var setUnloadVal = $("#txtSetUnload").val();
                if (setUnloadVal == '1') {
                    $('#pSetUnload').html('Set Unload : Done <span class="error-message" id="errSetUnload"></span>');
                    $("#txtStep2b").val('OK');
                    idx = 23;
                }
                else {
                    
                    // get current column
                    var realCol = await loadPLCGetCurrentColumn(loaderId);
                    if (Number(realCol) == 0) {
                        // $('#txtStep2c').removeClass("hidden");
                        $('#pCol2').html('Column Ready : <span style="color:red; font-size:15px;" id="errCol2"> No Column return. Please check Auto Loader. </span>');
                    }
                    else {
                        $('#pCol2').html('Column Ready : ' + Number(realCol) + '<span style="color:red; font-size:15px;" id="errCol2"> </span>');

                        $('#txtHCol').html(Number(realCol));

                        var chkUnload = await loadPLCSetLoaderUnload(loaderId);
                        console.log('R2.2::' + chkUnload);
                        if (chkUnload == true) {
                            $("#txtStep2b").val('OK');
                            await delay(5000);
                            idx = 23;
                        }
                        else {
                            $('#btnRetry2b').removeClass("hidden");
                            return;
                        }

                    }

                }
            }
            if (idx == 23) {
                var chkGripper = await loadPLCCheckUnlodingStatus(loaderId);
                console.log('R2.3::' + chkGripper);
                if (chkGripper == true) {
                                        
                    var turnStatus = await turnColFirst(0);
                    if (turnStatus == false) {
                        return;
                    }
                    idx = 24;
                }
                else {
                    $('#btnRetry2c').removeClass("hidden");
                    return;
                }
            }
            if (idx == 24) {
                $("#txtStep2c").val('OK');
                const chkAutoRun = document.getElementById('chkAutoRun');
                if (chkAutoRun.checked) {
                    nextTo3();
                    return;
                }
                else {
                    $('#btnNext2').removeClass("hidden");
                }
            }

            // step 3 : get Empty Tray Slot and Reel info
            var cont3 = false;
            if (idx == 3) {
                cont3 = true;
                var chkSlot = await loadPLCGetEmptyTraySlot();
                console.log('R3.1::' + chkSlot);
                if (chkSlot == true) {
                    var getScanReel = await loadPLCGetScanReel();
                    console.log('R3.2::' + getScanReel);
                    if (getScanReel == true) {
                        await delay(3000);
                        var getSlot = await loadPLCGetTrayReel(loaderId);
                        console.log('R3.3::' + getSlot);
                        await delay(8000);
                        idx = 31;
                    }
                }
                else {
                    $('#btnRetry3').removeClass("hidden");
                    return;
                }
            }
            if (idx == 30) {
                var chkTake = await loadPLCTakeEmptyTray();
                console.log('R3.10::' + chkTake);
                if (chkTake == true) {
                    idx = 31;
                }
                else {
                    $('#btnRetry3a1').removeClass("hidden");
                    return;
                }
            }
            if (idx == 31) {
                var chkSlot = await loadPLCGetRetrieveTrayStatus();
                console.log('R3.11::' + chkSlot);
                // if (chkSlot == true) {
                // }
                // else {
                //     // $('#btnRetry3a').removeClass("hidden");
                // }
                var step3a = $("#txtStep3a").val();
                var step3b = $("#txtStep3b").val();
                var step3c = $("#txtStep3c").val();
                var step3d = $("#txtStep3d").val();
                var step3e = $("#txtStep3e").val();
                if (step3b == "OK" && step3c == "OK" && step3d == "OK") {
                    idx = 32;
                }
                if (step3a == "OK" && step3b == "OK" && step3c == "OK" && step3d == "OK" && step3e == "OK") {
                    // $('#btnNext3').removeClass("hidden");

                    const chkAutoRun = document.getElementById('chkAutoRun');
                    if (chkAutoRun.checked) {
                        nextTo4();
                        return;
                    }
                    else {
                        $('#btnNext3').removeClass("hidden");
                    }
                }
                if (cont3 == false) {
                    return;
                }
            }
            if (idx == 33) {
                var chkReel = await loadPLCStartBarcodeScanner();
                console.log('R3.13::' + chkReel);
                if (chkReel == true) {
                    idx = 34;
                }
                else {
                    $('#btnRetry3b').removeClass("hidden");
                    return;
                }
            }
            if (idx == 34) {
                var chkReel = await loadPLCScanReelID();
                console.log('R3.14::' + chkReel);
                if (chkReel == true) {
                    idx = 35;
                }
                else {
                    // $('#btnRetry3c').removeClass("hidden");
                    return;
                }
            }
            if (idx == 35) {
                var chkReel = await loadPLCSetActualHeight(loaderId);
                console.log('R3.15::' + chkReel);
                if (chkReel == true) {
                    var step3a = $("#txtStep3a").val();
                    var step3b = $("#txtStep3b").val();
                    var step3c = $("#txtStep3c").val();
                    var step3d = $("#txtStep3d").val();
                    if (step3b == "OK" && step3c == "OK" && step3d == "OK") {
                        idx = 32;
                    }
                }
                else {
                    $('#btnRetry3d').removeClass("hidden");
                    return;
                }
            }

            if (idx == 32) {
                var chkReel = await loadPLCGetPickStatus();
                console.log('R3.12::' + chkReel);
                if (chkReel == true) {
                    var step3a = $("#txtStep3a").val();
                    var step3b = $("#txtStep3b").val();
                    var step3c = $("#txtStep3c").val();
                    var step3d = $("#txtStep3d").val();
                    var step3e = $("#txtStep3e").val();
                    if (step3a == "OK" && step3b == "OK" && step3c == "OK" && step3d == "OK" && step3e == "OK") {
                        // $('#btnNext3').removeClass("hidden");
                        const chkAutoRun = document.getElementById('chkAutoRun');
                        if (chkAutoRun.checked) {
                            nextTo4();
                            return;
                        }
                        else {
                            $('#btnNext3').removeClass("hidden");
                        }
                    }
                }
                else {
                    // $('#btnRetry3b').removeClass("hidden");
                }
                return;
            }

            // step 4 : Place and Put Away
            var cont4 = false;
            if (idx == 4) {
                idx = 41;
                cont4 = true;
            }
            if (idx == 41) {
                var chkSlot = await loadPLCGetSlot();
                console.log('R4.1::' + chkSlot);
                if (chkSlot == true) {
                    $("#txtStep4a").val("OK");
                }
                else {
                    $('#btnRetry4a').removeClass("hidden");
                    return;
                }
                idx = 42;
            }
            if (idx == 42) {
                var chkPlace = await loadPLCPlaceReel();
                console.log('R4.21::' + chkPlace);
                if (chkPlace == true) {
                    await delay(7000);

                    var chkPlaceStatus = await loadPLCGetPlaceStatus();
                    console.log('R4.22::' + chkPlaceStatus);
                    if (chkPlaceStatus == true) {
                        $("#txtStep4b").val("OK");
                    }
                    else {
                        $('#btnRetry4b2').removeClass("hidden");
                        return;
                    }
                }
                else {
                    $('#btnRetry4b1').removeClass("hidden");
                    return;
                }
                idx = 43;
            }
            if (idx == 45) {
                var chkPlaceStatus = await loadPLCGetPlaceStatus();
                console.log('R4.22::' + chkPlaceStatus);
                if (chkPlaceStatus == true) {
                    $("#txtStep4b").val("OK");
                }
                else {
                    $('#btnRetry4b2').removeClass("hidden");
                    return;
                }
                idx = 43;
            }
            if (idx == 43) {
                var chkPA= await loadPLCPutAway();
                console.log('R4.3::' + chkPA);
                if (chkPA == true) {
                    await delay(10000);
                    idx = 44;
                }
                else {
                    $('#btnRetry4c1').removeClass("hidden");
                    return;
                }
            }
            if (idx == 44) {
                var chkPA= await loadPLCGetPutAwayStatus();
                console.log('R4.4::' + chkPA);
                if (chkPA == true) {
                    $("#txtStep4c").val("OK");
                    
                    // $('#btnNext4').removeClass("hidden");
                    const chkAutoRun = document.getElementById('chkAutoRun');
                    if (chkAutoRun.checked) {
                        nextTo5();
                        return;
                    }
                    else {
                        $('#btnNext4').removeClass("hidden");
                    }
                    // await delay(3000);
                }
                else {
                    $('#btnRetry4c2').removeClass("hidden");
                    return;
                }
            }

            // step 5 : Scan and Put Away
            if (idx == 5) {
                resetColorPLCForm(5);
                var chkLast= await loadPLCFinal();
                console.log('R5::' + chkLast);
                if (chkLast == -1) {
                    $('#btnRetryLast').removeClass("hidden");
                    return;
                }
                else if (chkLast == 1) {
                    $("#txtDone").val('1');
                    // need turn
                    const chkAutoRun = document.getElementById('chkAutoRun');
                    if (chkAutoRun.checked) {
                        turnCol(0);
                    }
                    else {
                        $("#warnTurnModal").modal("toggle");
                    }
                    return;
                }
                else if (chkLast == 2) {
                    $("#txtDone").val('2');
                    // all done
                    var iCol = $("#txtICol").val();
                    for (var iC = Number(iCol); iC <= 4; iC++) {
                        await delay(1000);
                        $("#txtICol").val(iC);
                        var setE = await loadPLCSetColumnEmpty(loaderId, Number(iC));
                        console.log('R5.2::' + setE);
                        if (setE == false) {
                            $('#btnRetryLastSetEmpty2').removeClass("hidden");
                        }
                    }
                    return;
                }
                // else if (chkLast == 5) {
                //     idx = 51;
                // }
                else {
                    await delay(3000);
                    var tempEnd = $("#txtTempEndTask").val();
                    if (tempEnd == "0") {
                        nextReel();
                    }
                    return;
                }
                            
            }
            if (idx == 52) {
                var iCol = $("#txtICol").val();
                var realCol = Number(iCol) - 1; // await loadPLCGetCurrentColumn(loaderId);
                var setE = await loadPLCSetColumnEmpty(loaderId, Number(realCol));
                console.log('R5.2::' + setE);
                if (setE == false) {
                    $('#btnRetryLastSetEmpty').removeClass("hidden");
                    return;
                }
                else {
                    await delay(8000);
                    idx = 53;
                }
            }
            if (idx == 53) {
                var getR = await loadPLCReadyStatus(loaderId);
                console.log('R5.3::' + getR);
                if (getR == false) {
                    $('#btnRetryLastReadyStatus').removeClass("hidden");
                    return;
                }
                else {
                    idx = 54;
                }
            }
            if (idx == 54) {
                var iCol = $("#txtICol").val();
                var getT = await loadPLCTurn(loaderId, Number(iCol));
                console.log('R5.4::' + getT);
                if (getT == false) {
                    $('#btnRetryLastTurn').removeClass("hidden");
                }
                else {
                    await delay(3000);
                    nextReel();
                }
                return;
            }

            if (idx == 55) {
                var iCol = $("#txtICol").val();
                for (var iC = Number(iCol); iC <= 4; iC++) {
                    await delay(1000);
                    var setE = await loadPLCSetColumnEmpty(loaderId, Number(iC));
                    console.log('R5.5::' + setE);
                    if (setE == false) {
                        $('#btnRetryLastSetEmpty2').removeClass("hidden");
                    }
                }
                return;
            }
        }

        async function loadPLCCheckLoader(loaderId) {

            var fResult = false;

            await $.ajax({
                url: "/api/PLCLoader/GetLoaderId/" + loaderId,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    console.log('1::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $('#pLoader1').html("Loader : " + result.data + ' <span class="error-message" id="err1"></span>');

                        fResult = true;
                    }
                    else {
                        $('#pLoader1').html('Loader : <span class="error-message" id="err1"> ' + result.errMessage + ' </span>');
                    }
                },
                error: function (error) {
                    $('#pLoader1').html('Loader : <span class="error-message" id="err1"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        // function getLoaderColumn(loaderId) {
        //     $.ajax({
        //         url: "/loader/GetLoaderColumn/",
        //         type: "POST",
        //         data: JSON.stringify(loaderId),
        //         dataType: 'JSON',
        //         contentType: 'application/json; charset=utf-8',
        //         success: function (result) {
        //             result.data.forEach(item => {
        //                 const colNo = item.colNo;
        //                 const usagePercentage = item.usagePercentage;
        //                 const colHeight = item.colHeight;
        //                 const balanceHeight = item.balanceHeight;

        //                 $(`#percent-c${colNo}`).text(`${usagePercentage}%`);
        //                 $(`#balance-c${colNo}`).text(`${balanceHeight}`);
        //                 $(`#colHeight-c${colNo}`).text(`${colHeight}`);
        //                 $(`#c${colNo}`).css('width', `${usagePercentage}%`);
        //             });

        //         },
        //         error: function (error) {

        //         }
        //     });
        // }

        async function loadPLCCheckFlexilock() {

            var fResult = false;

            await $.ajax({
                url: "/api/PLCHubIn/GetFlexilockStatus/",
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    console.log('2::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $('#pFlexi1').html('Flexilock 1 : Right is locked. <span class="error-message" id="errFlexi1"></span>');
                        $('#pFlexi2').html('Flexilock 2 : Left is locked. <span class="error-message" id="errFlexi2"></span>');

                        fResult = true;
                    }
                    else {
                        if (result.data[0] != 1) {
                            $('#pFlexi1').html('Flexilock 1 : <span class="error-message" id="errFlexi1"> ' + result.errMessage + ' </span>');
                        }
                        else {
                            $('#pFlexi1').html('Flexilock 1 : Right is locked. <span class="error-message" id="errFlexi1"></span>');
                        }
                        if (result.data[1] != 1) {
                            $('#pFlexi2').html('Flexilock 2 : <span class="error-message" id="errFlexi2"> ' + result.errMessage + ' </span>');
                        }
                        else {
                            $('#pFlexi2').html('Flexilock 2 : Left is locked. <span class="error-message" id="errFlexi2"></span>');
                        }

                    }
                },
                error: function (error) {
                    $('#pFlexi1').html('Flexilock 1 : <span class="error-message" id="errFlexi1"> ' + error.val + ' </span>');
                    $('#pFlexi2').html('Flexilock 2 : <span class="error-message" id="errFlexi2"></span>');
                }
            });

            return fResult;
        }

        async function loadPLCSetLoaderUnload(loaderId) {

            var fResult = false;

            await $.ajax({
                url: "/api/PLCHubIn/SetLoaderUnload/" + loaderId,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    console.log('2::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $("#txtSetUnload").val("1");
                        $('#pSetUnload').html('Set Unload : Done <span class="error-message" id="errSetUnload"></span>');

                        fResult = true;
                    }
                    else {
                        $('#pSetUnload').html('Set Unload : <span class="error-message" id="errSetUnload"> ' + result.errMessage + ' </span>');
                    }
                },
                error: function (error) {
                    $('#pSetUnload').html('Set Unload : <span class="error-message" id="errSetUnload"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCCheckUnlodingStatus(loaderId) {

            var fResult = false;

            await $.ajax({
                url: "/api/PLCHubIn/GetUnlodingStatus/" + loaderId,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    console.log('2::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $('#pLoaderFork').html('Fork Status : Ready. <span class="error-message" id="errLoaderFork2"></span>');
                        $('#pGripper2').html('Gantry Status : Ready. <span class="error-message" id="errGripper2"></span>');

                        fResult = true;
                    }
                    else {
                        if (result.data[0] != "2") {
                            $('#pGripper2').html('Gantry Status : <span class="error-message" id="errGripper2"> ' + result.errMessage + ' </span>');
                        }
                        else {
                            $('#pGripper2').html('Gantry Status : Ready. <span class="error-message" id="errGripper2"></span>');
                        }
                        if (result.data[1] != "16") {
                            $('#pLoaderFork').html('Fork Status : <span class="error-message" id="errLoaderFork2"> ' + result.errMessage + ' </span>');
                        }
                        else {
                            $('#pLoaderFork').html('Fork Status : Ready. <span class="error-message" id="errLoaderFork2"></span>');
                        }
                    }
                },
                error: function (error) {
                    $('#pLoaderFork').html('Fork Status : <span class="error-message" id="errLoaderFork2"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCStartBarcodeScanner() {

            var fResult = false;

            await $.ajax({
                url: "/api/PLCHubIn/StartBarcodeScanner/",
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('2::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $("#txtStep3b").val('OK');
                        // $('#pSetUnload').html('Set Unload : Done <span class="error-message" id="errSetUnload"></span>');

                        fResult = true;
                    }
                    else {
                        // $('#pSetUnload').html('Set Unload : <span class="error-message" id="errSetUnload"> ' + result.errMessage + ' </span>');
                    }
                },
                error: function (error) {
                    // $('#pSetUnload').html('Set Unload : <span class="error-message" id="errSetUnload"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCScanReelID() {

            var fResult = false;

            await $.ajax({
                url: "/api/PLCHubIn/GetReelID/",
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('2::' + JSON.stringify(result));
                    // swal.close();

                    // if (result.data.successScan) {
                    //     $("#txtStep3b").val('OK');

                    //     $('#pReel3').html("Reel ID : " + result.data.scannedBarcode + ' <span class="error-message" id="errReel3"></span>');
                    // }
                    // else {
                    //     $('#btnRetry3b').removeClass("hidden");
                    //     $('#pReel3').html('Reel ID : <span class="error-message" id="errGetTray3">' + result.data.errMessageScan + '</span>');
                    // }

                    if (result.data.successReel) {
                        $("#txtStep3c").val('OK');

                        $('#pReel3').html("Reel ID : " + result.data.scannedBarcode + ' <span class="error-message" id="errReel3"></span>');
                        $('#pItem3').html("Item Code : " + result.data.itemCode + ' <span class="error-message" id="errItem3"></span>');
                        $('#pActHeight3').html("Actual Height : " + result.data.actualHeight + ' ');

                        $("#txtHReel").html(result.data.scannedBarcode);
                        $("#txtHItem").val(result.data.itemCode);
                        $("#txtHActH").val(result.data.actualHeight);

                        $("#txtReelId").val(result.data.reel_Id);
                        $("#txtReelCode").val(result.data.reelCode);
                        $("#txtActHeight").val(result.data.actualHeight);
                    }
                    else {
                        $('#btnRetry3c').removeClass("hidden");
                        $('#pItem3').html('Get Reel Status : <span class="error-message" id="errItem3">' + result.data.errMessageReel + '</span>');
                    }
                    
                    if (result.success == true) {
                        fResult = true;
                    }
                },
                error: function (error) {
                    $('#pSetUnload').html('Set Unload : <span class="error-message" id="errSetUnload"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCSetActualHeight(loaderId) {

            var actH = $("#txtActHeight").val();
            var fResult = false;

            await $.ajax({
                url: "/api/PLCHubIn/SetActualHeight/" + loaderId + "/" + actH,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('2::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $("#txtStep3d").val('OK');

                        $('#pGetReel3').html('Get Reel Status : Done. <span class="error-message" id="errGetReel3"></span>');

                        fResult = true;
                    }
                    else {
                        $('#btnRetry3d').removeClass("hidden");
                        $('#pGetReel3').html('Get Reel Status : <span class="error-message" id="errGetReel3">' + result.errMessage + '</span>');
                    }
                },
                error: function (error) {
                    $('#pSetUnload').html('Set Unload : <span class="error-message" id="errSetUnload"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCGetEmptyTraySlot() {

            var fResult = false;

            // step 2 : scan item
            await $.ajax({
                url: "/api/PLCHubIn/GetEmptyTraySlot/",
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    console.log('3::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $('#pETray3').html("Empty Tray Slot : " + result.data.slotCode + ' <span class="error-message" id="errETray3"></span>');

                        $("#txtHEmpty").val(result.data.slotCode);

                        fResult = true;
                    }
                    else {
                        $('#pETray3').html('Empty Tray Slot : <span class="error-message" id="errETray3"> ' + result.errMessage + ' </span>');
                    }
                },
                error: function (error) {
                    $('#pETray3').html('Empty Tray Slot : <span class="error-message" id="errETray3"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCTakeEmptyTray() {

            var eSlot = $("#txtHEmpty").val();
            var fResult = false;

            await $.ajax({
                url: "/api/PLCHubIn/RetrieveTray/" + eSlot,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    console.log('3::' + JSON.stringify(result));
                    // swal.close();
                    if (result.data.successTray) {
                        // $("#txtStep3a").val('OK');

                        $('#pGetTray3').html('Get Tray Status : Done. <span class="error-message" id="errGetTray3"></span>');
                    }
                    else {
                        $('#btnRetry3a1').removeClass("hidden");
                        $('#pGetTray3').html('Get Tray Status : <span class="error-message" id="errGetTray3">' + result.data.errMessageTray + '</span>');
                    }

                    fResult = result.data.successTray;
                },
                error: function (error) {
                    $('#pGetTray3').html('Get Tray Status : <span class="error-message" id="errGetTray3"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCGetScanReel() {

            var fResult = false;

            await $.ajax({
                url: "/api/PLCHubIn/ScanReelGetReelID",
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    console.log('3.0::' + JSON.stringify(result));
                    // swal.close();
                    if (result.data.successStartScan) {
                        $("#txtStep3b").val('OK');

                        $('#pReel3').html("Reel ID : " + result.data.scannedBarcode + ' <span class="error-message" id="errReel3"></span>');
                    }
                    else {
                        $('#btnRetry3b').removeClass("hidden");
                        $('#pReel3').html('Reel ID : <span class="error-message" id="errGetTray3">' + result.data.errMessageStartScan + '</span>');
                    }

                    if (result.data.successReel) {
                        $("#txtStep3c").val('OK');

                        $('#pItem3').html("Item Code : " + result.data.itemCode + ' <span class="error-message" id="errItem3"></span>');
                        $('#pActHeight3').html("Actual Height : " + result.data.actualHeight + ' ');

                        $("#txtHReel").val(result.data.reelCode);
                        $("#txtHItem").val(result.data.itemCode);
                        $("#txtHActH").val(result.data.actualHeight);

                        $("#txtReelId").val(result.data.reel_Id);
                        $("#txtReelCode").val(result.data.reelCode);
                        $("#txtActHeight").val(result.data.actualHeight);
                    }
                    else {
                        if (result.data.successStartScan) {
                            $('#btnRetry3c').removeClass("hidden");
                        }
                        $('#pItem3').html('Item Code : <span class="error-message" id="errItem3">' + result.data.errMessageReel + '</span>');
                    }

                    if (result.success == true) {
                        fResult = true;
                    }
                    else {
                        $('#btnRetry3a1').removeClass("hidden");
                    }
                },
                error: function (error) {
                    $('#pGetTray3').html('Get Tray Status : <span class="error-message" id="errGetTray3"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCGetTrayReel(loaderId) {

            var eSlot = $("#txtHEmpty").val();
            var actH = $("#txtActHeight").val();
            var fResult = false;

            await $.ajax({
                url: "/api/PLCHubIn/RetrieveTrayAndReel/" + eSlot + "/" + loaderId + "/" + actH,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    console.log('3::' + JSON.stringify(result));
                    // swal.close();
                    if (result.data.successTray) {
                        // $("#txtStep3a").val('OK');

                        $('#pGetTray3').html('Get Tray Status : Done. <span class="error-message" id="errGetTray3"></span>');
                    }
                    else {
                        $('#btnRetry3a1').removeClass("hidden");
                        $('#pGetTray3').html('Get Tray Status : <span class="error-message" id="errGetTray3">' + result.data.errMessageTray + '</span>');
                    }

                    // if (result.data.successStartScan) {
                    //     $("#txtStep3b").val('OK');

                    //     $('#pReel3').html("Reel ID : " + result.data.scannedBarcode + ' <span class="error-message" id="errReel3"></span>');
                    // }
                    // else {
                    //     $('#btnRetry3b').removeClass("hidden");
                    //     $('#pReel3').html('Reel ID : <span class="error-message" id="errGetTray3">' + result.data.errMessageStartScan + '</span>');
                    // }

                    // if (result.data.successReel) {
                    //     $("#txtStep3c").val('OK');

                    //     $('#pItem3').html("Item Code : " + result.data.itemCode + ' <span class="error-message" id="errItem3"></span>');
                    //     $('#pActHeight3').html("Actual Height : " + result.data.actualHeight + ' ');

                    //     $("#txtHReel").val(result.data.reelCode);
                    //     $("#txtHItem").val(result.data.itemCode);
                    //     $("#txtHActH").val(result.data.actualHeight);

                    //     $("#txtReelId").val(result.data.reel_Id);
                    //     $("#txtReelCode").val(result.data.reelCode);
                    //     $("#txtActHeight").val(result.data.actualHeight);
                    // }
                    // else {
                    //     if (result.data.successStartScan) {
                    //         $('#btnRetry3c').removeClass("hidden");
                    //     }
                    //     $('#pItem3').html('Item Code : <span class="error-message" id="errItem3">' + result.data.errMessageReel + '</span>');
                    // }

                    if (result.data.successSetH) {
                        $("#txtStep3d").val('OK');

                        $('#pGetReel3').html('Get Reel Status : Done. <span class="error-message" id="errGetReel3"></span>');
                    }
                    else {
                        if (result.data.successStartScan && result.data.successReel) {
                            $('#btnRetry3d').removeClass("hidden");
                        }
                        $('#pGetReel3').html('Get Reel Status : <span class="error-message" id="errGetReel3">' + result.data.errMessageSetH + '</span>');
                    }

                    if (result.success == true) {
                        fResult = true;
                    }
                },
                error: function (error) {
                    $('#pGetTray3').html('Get Tray Status : <span class="error-message" id="errGetTray3"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCGetRetrieveTrayStatus() {

            var fResult = false;

            // step 4 : scan item
            await $.ajax({
                url: "/api/PLCHubIn/GetRetrieveTrayStatus/",
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('3::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $("#txtStep3a").val('OK');

                        $('#pGetTray3').html('Get Tray Status : Ready. <span class="error-message" id="errGetTray3"></span>');
                        fResult = true;
                    }
                    else {
                        $('#btnRetry3a2').removeClass("hidden");
                        $('#pGetTray3').html('Get Tray Status : <span class="error-message" id="errGetTray3">' + result.errMessage + '</span>');
                    }
                },
                error: function (error) {
                    $('#pGetTray3').html('Get Tray Status : <span class="error-message" id="errGetTray3"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCGetPickStatus() {

            var fResult = false;

            // step 4 : scan item
            await $.ajax({
                url: "/api/PLCHubIn/GetPickStatus/",
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('3::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $("#txtStep3e").val('OK');
                        $('#pPick3').html('Pick Status : Done. <span class="error-message" id="errPick3"></span>');
                        fResult = true;
                    }
                    else {
                        $('#btnRetry3e').removeClass("hidden");
                        $('#pPick3').html('Pick Status : <span class="error-message" id="errPick3">' + result.errMessage + '</span>');
                    }
                },
                error: function (error) {
                    $('#pPick3').html('Pick Status : <span class="error-message" id="errPick3"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCGetSlot() {

            var actH = $("#txtActHeight").val();
            var fResult = false;

            // step 4 : scan item
            await $.ajax({
                url: "/api/PLCHubIn/GetBottomSlot/" + actH,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('4::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $('#pSlot4').html("Slot Code : " + result.data.slotCode + ' <span class="error-message" id="errSlot4"></span>');
                        $('#pSlotTake4').html("Slot Reserve : " + result.data.totalSlot + ' <span class="error-message" id="errSlotTake4"></span>');

                        $("#txtHSlot").val(result.data.slotCode);
                        $("#txtHSlotTake").val(result.data.totalSlot);

                        fResult = true;
                    }
                    else {
                        $('#pSlot4').html('Slot Code: <span class="error-message" id="errSlot4"> ' + result.errMessage + ' </span>');
                    }
                },
                error: function (error) {
                    $('#pSlot4').html('Slot Code : <span class="error-message" id="errSlot4"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCPlaceReel() {

            var fResult = false;

            // step 4 : scan item
            await $.ajax({
                url: "/api/PLCHubIn/PutReelOnTray/",
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('4::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $('#pPlace4').html('Place to Tray Status : Loading... <span class="error-message" id="errPlace4"></span>');
                        fResult = true;
                    }
                    else {
                        $('#pPlace4').html('Place to Tray Status : <span class="error-message" id="errPlace4">' + result.errMessage + '</span>');
                    }
                },
                error: function (error) {
                    $('#pPlace4').html('Place to Tray Status : <span class="error-message" id="errPlace4"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCGetPlaceStatus() {

            var fResult = false;

            // step 4 : scan item
            await $.ajax({
                url: "/api/PLCHubIn/GetPlaceStatus/",
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('4::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $('#pPlace4').html('Place to Tray Status : Done. <span class="error-message" id="errPlace4"></span>');
                        fResult = true;
                    }
                    else {
                        $('#pPlace4').html('Place to Tray Status : <span class="error-message" id="errPlace4">' + result.errMessage + '</span>');
                    }
                },
                error: function (error) {
                    $('#pPlace4').html('Place to Tray Status : <span class="error-message" id="errPlace4"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCPutAway() {

            var tCode = $("#txtHEmpty").val();
            var sCode = $("#txtHSlot").val();
            var sTake = $("#txtHSlotTake").val();
            var fResult = false;

            // step 4 : scan item
            await $.ajax({
                url: "/api/PLCHubIn/PutAway/" + sCode + "/" + sTake,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('4::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $('#pPutAway4').html('Put Away Status : Loading ... <span class="error-message" id="errPutAway4"></span>');

                        fResult = true;
                    }
                    else {
                        $('#pPutAway4').html('Put Away Status : <span class="error-message" id="errPutAway4"> ' + result.errMessage + ' </span>');
                    }
                },
                error: function (error) {
                    $('#pPutAway4').html('Put Away Status : <span class="error-message" id="errPutAway4"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCGetPutAwayStatus() {

            var fResult = false;

            // step 4 : scan item
            await $.ajax({
                url: "/api/PLCHubIn/GetPutAwayStatus/",
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('4::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $('#pPutAway4').html('Put Away Status : Done <span class="error-message" id="errPutAway4"></span>');

                        fResult = true;
                    }
                    else {
                        $('#pPutAway4').html('Put Away Status : <span class="error-message" id="errPutAway4"> ' + result.errMessage + ' </span>');
                    }
                },
                error: function (error) {
                    $('#pPutAway4').html('Put Away Status : <span class="error-message" id="errPutAway4"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCFinal() {

            var lId = $("#txtLoaderId").val();
            var col = $("#txtICol").val();
            var rId = $("#txtReelId").val();
            var sCode = $("#txtHSlot").val();
            var sTake = $("#txtHSlotTake").val();
            var fResult = -1;

            // step 4 : scan item
            await $.ajax({
                url: "/api/PLCHubIn/UpdateReelIntoRack/" + lId + "/" + col + "/" + rId + "/" + sCode + "/" + sTake,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    console.log('5::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        updateLoaderInfo();

                        if (result.data == 2) {
                            $("#txtICol").val("1");
                            $('#pTextLast').html("Loader is DONE put away.");
                        }
                        else if (result.data == 1) {
                            var iCol = $("#txtICol").val();
                            $("#txtICol").val(Number(iCol) + 1);
                            $('#pTextLast').html("Loader Column [" + iCol + "] is DONE put away, ready to turn column... ");
                        }
                        // else if (result.data == 5) {
                        //     $('#pTextLast').html("Ready to end task...");
                        // }
                        else {
                            $('#btnTempEndTask').removeClass("hidden");
                            $('#pTextLast').html("Done Update. Will continue next item after 2 seconds...");
                        }

                        fResult = result.data;

                    }
                    else {
                        $('#pTextLast').html('<span style="color:red; font-size:15px;">' + result.errMessage+ '</span>');
                    }

                },
                error: function (error) {
                    $('#pTextLast').html('<span style="color:red; font-size:15px;">' + error.val + '</span>');
                }
            });

            return fResult;
        }

        async function loadPLCGetCurrentColumn(loaderId) {

            var fResult = false;

            await $.ajax({
                url: "/api/PLCLoader/GetCurrentColumn/" + loaderId,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    console.log('2.3::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        fResult = true;
                    }
                    else {
                        $('#pCol2').html('Column Ready : <span style="color:red; font-size:15px;" id="errCol2">' + result.errMessage + ' </span>');
                    }
                },
                error: function (error) {
                    $('#pCol2').html('Column Ready : <span style="color:red; font-size:15px;" id="errCol2">' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function turnCol(offModal) {
            $('#divTurn').removeClass("hidden");
            if (offModal == 1) {
                $("#warnTurnModal").modal("toggle");
            }
            var loaderId = $("#txtLoaderId").val();
            var iCol = $("#txtICol").val();
            var realCol = Number(iCol) - 1; // await loadPLCGetCurrentColumn(loaderId);
            if (Number(realCol) == 0) {
                $('#btnRetry3').removeClass("hidden");
            }
            else {
                if (realCol < iCol) {
                    var setE = await loadPLCSetColumnEmpty(loaderId, Number(realCol));
                    if (setE == false) {
                        $('#btnRetryLastSetEmpty').removeClass("hidden");
                        return;
                    }
                    else {
                        await delay(8000);
                        var getR = await loadPLCReadyStatus(loaderId);
                        if (getR == false) {
                            $('#btnRetryLastReadyStatus').removeClass("hidden");
                            return;
                        }
                        else {
                            var getT = await loadPLCTurn(loaderId, Number(iCol));
                            if (getT == false) {
                                $('#btnRetryLastTurn').removeClass("hidden");
                                return;
                            }
                            else {
                                    $("#txtDone").val('0');
                                    await delay(3000);
                                    realCol = iCol; // (realCol) + 1;
                                    nextReel();
                            }
                        }
                    }
                }

                // wait for fork is ready
                // await delay(3000);
            }
        }

        async function endTask() {
            var loaderId = $("#txtLoaderId").val();
            if (loaderId == "") {
                swal.fire({
                    icon: 'error',
                    title: "Wait",
                    text: "No loader is selected."
                });
                return;
            }

            var chkEnd = await loadPLCEndTask(loaderId, true);
            console.log('R10::' + chkEnd);
            return;
        }

        async function loadPLCEndTask(loaderId, btnEnd) {
            
            var fResult = false;

            await $.ajax({
                url: "/api/PLCHubIn/UnloadEndTask/" + loaderId,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    console.log('10::' + JSON.stringify(result));
                    // swal.close();
                    if (btnEnd == false) {
                        if (result.success == true) {
                            $('#pTextLast').html("Done End Task. Will continue next item after 2 seconds...");
                            fResult = true;
                        }
                    }
                    else {
                        if (result.success == true) {
                            fResult = true;
                            swal.fire({
                                icon: 'success',
                                title: "Success End Task",
                                text: "",
                                didClose: () => {
                                    window.location.reload();
                                }
                            });
                        }
                        else {
                            swal.fire({
                                icon: 'error',
                                title: "Wait",
                                text: result.errMessage
                            });
                        }
                    }
                },
                error: function (error) {
                    if (btnEnd == false) {
                    }
                    else {
                        swal.fire({
                            icon: 'error',
                            title: "Wait",
                            text: error.val
                        });
                    }
                }
            });

            return fResult;
        }

        async function loadPLCTempEndTask(loaderId) {

            var fResult = false;

            await $.ajax({
                url: "/api/PLCHubIn/UnloadTempEndTask/" + loaderId,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('10::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        fResult = true;
                        swal.fire({
                            icon: 'success',
                            title: "Success End Task",
                            text: "",
                            didClose: () => {
                                window.location.reload();
                            }
                        });
                    }
                    else {
                        swal.fire({
                            icon: 'error',
                            title: "Wait",
                            text: result.errMessage
                        });
                    }
                },
                error: function (error) {
                    if (btnEnd == false) {
                    }
                    else {
                        swal.fire({
                            icon: 'error',
                            title: "Wait",
                            text: error.val
                        });
                    }
                }
            });

            return fResult;
        }

        async function loadPLCSetColumnEmpty(loaderId, curCol) {

            var fResult = false;
            $('#pEmptyColLast').html('Set Empty Column : Loading ... <span class="error-message" id="errEmptyColLast"> </span>');

            await $.ajax({
                url: "/api/PLCHubIn/SetColumnEmpty/"+ loaderId + "/" + curCol,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('2::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        fResult = true;
                        $('#pEmptyColLast').html('Set Empty Column : Done <span class="error-message" id="errEmptyColLast"> </span>');
                        $('#pEmptyCol2').html('Set Empty Column : Done <span class="error-message" id="errEmptyCol2"> </span>');
                    }
                    else {
                        $('#pEmptyColLast').html('Set Empty Column : <span class="error-message" id="errEmptyColLast"> ' + result.errMessage + ' </span>');
                        $('#pEmptyCol2').html('Set Empty Column : <span class="error-message" id="errEmptyCol2"> ' + result.errMessage + ' </span>');
                    }
                },
                error: function (error) {
                    $('#pEmptyColLast').html('Set Empty Column : <span class="error-message" id="errEmptyColLast"> ' + error.val + ' </span>');
                    $('#pEmptyCol2').html('Set Empty Column : <span class="error-message" id="errEmptyColLast"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCReadyStatus(loaderId) {

            var fResult = false;
            $('#pStatusReadyLast').html('Status Ready to Turn Column : Loading ... <span class="error-message" id="errStatusReadyLast"> </span>');

            await $.ajax({
                url: "/api/PLCHubIn/GetReadyTurnStatus/"+ loaderId,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('2::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        fResult = true;
                        $('#pStatusReadyLast').html('Status Ready to Turn Column : Done <span class="error-message" id="errStatusReadyLast"> </span>');
                        $('#pStatusReady2').html('Status Ready to Turn Column : Done <span class="error-message" id="errStatusReady2"> </span>');
                    }
                    else {
                        $('#pStatusReadyLast').html('Status Ready to Turn Column : <span class="error-message" id="errStatusReadyLast"> ' + result.errMessage + ' </span>');
                        $('#pStatusReady2').html('Status Ready to Turn Column : <span class="error-message" id="errStatusReady2"> ' + result.errMessage + ' </span>');
                    }
                },
                error: function (error) {
                    $('#pStatusReadyLast').html('Status Ready to Turn Column : <span class="error-message" id="errStatusReadyLast"> ' + error.val + ' </span>');
                    $('#pStatusReady2').html('Status Ready to Turn Column : <span class="error-message" id="errStatusReady2"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        async function loadPLCTurn(loaderId, nextCol) {

            var fResult = false;
            $('#pTurnLast').html('Turn Column : Loading ... <span class="error-message" id="errTurnLast"> </span>');

            await $.ajax({
                url: "/api/PLCHubIn/SetTurnColumn/"+ loaderId + "/" + nextCol,
                type: "GET",
                dataType: 'JSON',
                // data: JSON.stringify(jsonInput),
                contentType: 'application/json; charset=utf-8',
                beforeSend: function () {

                },
                success: function (result) {
                    // console.log('2::' + JSON.stringify(result));
                    // swal.close();
                    if (result.success == true) {
                        $("#txtICol").val(nextCol);
                        fResult = true;
                        $('#pTurnLast').html('Turn Column : Done <span class="error-message" id="errTurnLast"> </span>');
                        $('#pTurn2').html('Turn Column : Done <span class="error-message" id="errTurn2"> </span>');
                    }
                    else {
                        $('#pTurnLast').html('Turn Column : <span class="error-message" id="errTurnLast"> ' + result.errMessage + ' </span>');
                        $('#pTurn2').html('Turn Column : <span class="error-message" id="errTurn2"> ' + result.errMessage + ' </span>');
                    }
                },
                error: function (error) {
                    $('#pTurnLast').html('Turn Column : <span class="error-message" id="errTurnLast"> ' + error.val + ' </span>');
                    $('#pTurn2').html('Turn Column : <span class="error-message" id="errTurn2"> ' + error.val + ' </span>');
                }
            });

            return fResult;
        }

        // async function loadPLCScanReel() {

        //     var fResult = false;

        //     // step 2 : scan item
        //     await $.ajax({
        //         url: "/api/PLCHubIn/ScanReelID/",
        //         type: "GET",
        //         dataType: 'JSON',
        //         // data: JSON.stringify(jsonInput),
        //         contentType: 'application/json; charset=utf-8',
        //         beforeSend: function () {

        //         },
        //         success: function (result) {
        //             console.log('4::' + JSON.stringify(result));
        //             // swal.close();
        //             if (result.success == true) {
        //                 $('#pReel4').html("Reel ID : " + result.data.reelCode + ' <span class="error-message" id="errReel4"></span>');
        //                 $('#pItem4').html("Item Code : " + result.data.itemCode + ' <span class="error-message" id="errItem4"></span>');
        //                 $('#pHeight4').html("Actual Height : " + result.data.actualHeight + ' ');

        //                 $("#txtHReel").val(result.data.reelCode);
        //                 $("#txtHItem").val(result.data.itemCode);
        //                 $("#txtHActH").val(result.data.actualHeight);

        //                 $("#txtReelId").val(result.data.reel_Id);
        //                 $("#txtReelCode").val(result.data.reelCode);
        //                 $("#txtActHeight").val(result.data.actualHeight);

        //                 fResult = true;
        //             }
        //             else {
        //                 $('#pReel4').html('Reel ID : <span class="error-message" id="errReel4"> ' + result.errMessage + ' </span>');
        //             }
        //         },
        //         error: function (error) {
        //             $('#pReel4').html('Reel ID : <span class="error-message" id="errReel4"> ' + error.val + ' </span>');
        //         }
        //     });

        //     return fResult;
        // }

    </script>
}